{% load static %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css">
    <script src="https://unpkg.com/htmx.org@1.9.11" integrity="sha384-0gxUXCCR8yv9FM2b+U3FDbsKthCI66oH5IA9fHppQq9DDMHuMauqq1ZHBpJxQ0J0" crossorigin="anonymous"></script> <!-- Htmx -->
    <script defer src="https://unpkg.com/@alpinejs/morph@3.10.2/dist/cdn.min.js"></script><!-- Alpine Plugins -->
    <script defer src="https://unpkg.com/alpinejs@3.10.2/dist/cdn.min.js"></script> <!-- Alpine Core -->
    {% include 'core/includes/form_date_scripts.html' %}

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'bootstrap_datepicker/css/bootstrap-datetimepicker.min.css' %}" />
    <link rel="stylesheet" href="{% static 'bootstrap_datepicker_plus/css/datepicker-widget.css' %}" />
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
    <link rel="stylesheet" href="{% static 'css/css-loader.css' %}">

    {% block head %}{% endblock head %}

    <title>{{ user.journal.title }}</title>
    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}"/>
  </head>

  <body tabindex="-1">
    {% block body %}
    <nav id="main-nav">
      <ul>
        <!-- Years Dropdown -->
        <li class="dropdown {% if '/' == request.path %}active{% endif %}">
          <a class="dropdown__title" href="{% url 'bookkeeping:index' %}">{{ request.user.year|title }}</a>
          <ul class="dropdown__menu">
            {% for y in years %}
            <li><a href="{% url 'core:set_year' y %}">{{ y|safe }}</a></li>
            {% endfor %}
          </ul>
        </li>

        <!-- Month -->
        <li class="{% if '/month/' == request.path %}active{% endif %}">
          <a href="{% url 'bookkeeping:month' %}">{% translate 'Month' %}</a>
        </li>

        <!-- Detailed -->
        <li class="{% if '/detailed/' == request.path %}active{% endif %}">
          <a href="{% url 'bookkeeping:detailed' %}">{% translate 'Detailed' %}</a>
        </li>

        <!-- Expenses -->
        <li class="dropdown {% if '/expenses/' in request.path and not '/summary/' in request.path %}active{% endif %}">
          <a class="dropdown__title" href="{% url 'expenses:index' %}">{% translate 'Expenses' %}</a>
          <ul class="dropdown__menu">
            {% for m in context_months %}
            {% with m|date:'n' as m_num %}
            <li>
              <a hx-get="{% url 'expenses:index'%}?month={{ forloop.counter }}" hx-target="body">{{ m|date:'F'|title }}</a>
            </li>
            {% endwith %}{% endfor %}
            <li class="dropdown-divider"></li>
            <li>
              <a hx-get="{% url 'expenses:index' %}?month=13" hx-target="body">{% translate 'All records' %}</a>
            </li>
          </ul>
        </li>

        <!-- Incomes -->
        <li class="{% if '/incomes/' in request.path %}active{% endif %}">
          <a href="{% url 'incomes:index' %}">{% translate 'Incomes' %}</a>
        </li>

        <!-- Transactions -->
        <li class="{% if '/transactions/' in request.path %}active{% endif %}">
          <a  href="{% url 'transactions:index' %}">{% translate 'Transactions' %}</a>
        </li>

        <!-- Savings -->
        <li class="{% if '/savings/' in request.path and not '/summary/' in request.path %}active{% endif %}">
          <a href="{% url 'savings:index' %}">{% translate 'Savings' %}</a>
        </li>

        <!-- Debts -->
        <li class="{% if '/debts/' in request.path %}active{% endif %}">
          <a href="{% url 'debts:index' %}">{% translate 'Debts' %}</a>
        </li>

        <!-- Books -->
        <li class="dropdown {% if '/books/' in request.path %}active{% endif %}">
          <a class="dropdown__title" href="{% url 'books:index' %}">{% translate 'Books' %}</a>
          <ul class="dropdown__menu">
            <li>
              <a href="{% url 'books:index' %}?tab=all">{% translate 'All records' %}</a>
            </li>
          </ul>
        </li>

        <!-- Drinks -->
        <li class="{% if '/drinks/' in request.path %}active{% endif %}">
          <a href="{% url 'drinks:index' %}">{% translate 'Drinks' %}</a>
        </li>

        <!-- Counters -->
        <li class="dropdown {% if '/counts/' in request.path %}active{% endif %}">
          <a class="dropdown__title" href="{% url 'counts:redirect' %}">{% translate 'Counter' %}</a>
          <ul class="dropdown__menu">
            {% if counts_menu %}{{ counts_menu }}{% endif %}
            <li class="dropdown-divider"></li>
            <li>
              <button type="button" hx-get="{% url 'counts:type_new' %}" hx-target="#mainModal">{% translate 'Add count type' %}</button>
            </li>
          </ul>
        </li>

        <!-- Plans -->
        <li class="{% if '/plans/' in request.path %}active{% endif %}">
          <a href="{% url 'plans:index' %}">{% translate 'Plans' %}</a>
        </li>

        <!-- Charts -->
        <li class="dropdown {% if 'summary' in request.path %}active{% endif %}">
          <a class="dropdown__title" href="{% url 'bookkeeping:summary' %}">{% translate 'Charts' %}</a>
          <ul class="dropdown__menu">
            <li>
              <a href="{% url 'bookkeeping:summary' %}">{% translate 'Incomes' %} & {% translate 'Expenses' %}</a>
            </li>
            <li>
              <a href="{% url 'bookkeeping:summary_savings_and_incomes' %}">{% translate 'Incomes'%} & {% translate 'Savings' %}</a>
            </li>
            <li>
              <a href="{% url 'bookkeeping:summary_savings' %}">{% translate 'Savings' %}</a>
            </li>
            <li>
              <a href="{% url 'bookkeeping:summary_expenses' %}">{% translate 'Expenses' %}</a>
            </li>
          </ul>
        </li>

        <!-- Add butons -->
        <li class="dropdown">
          <a class="dropdown__title" href="#" role="button">{% translate 'Add' %}</a>
          <ul class="dropdown__menu">
            <li>
              <button hx-get="{% url 'incomes:new' %}" hx-target="#mainModal">{% translate 'Incomes' context 'incomes button' %}</button>
            </li>
            <li>
              <button hx-get="{% url 'expenses:new' %}" hx-target="#mainModal">{% translate "Expenses" context "expenses button" %}</button>
            </li>
            <li>
              <button hx-get="{% url 'transactions:new' %}" hx-target="#mainModal">{% translate 'Transactions' context "transactions button" %}</button>
            </li>
            <li>
              <button hx-get="{% url 'savings:new' %}" hx-target="#mainModal">{% translate 'Savings' context "savings button" %}</button>
            </li>
            <li class="dropdown-divider"></li>
            <li>
              <button hx-get="{% url 'accounts:new' %}" hx-target="#mainModal">{% translate 'Account' context 'account button' %}</button>
            </li>
            <li>
              <button hx-get="{% url 'incomes:type_new' %}" hx-target="#mainModal">{% translate 'Incomes type' context 'income type button' %}</button>
            </li>
            <li>
              <button hx-get="{% url 'expenses:type_new' %}" hx-target="#mainModal">{% translate "Expenses type" context "expenses type button" %}</button>
            </li>
            <li>
              <button hx-get="{% url 'expenses:name_new' %}" hx-target="#mainModal">{% translate "Expenses name" context "expenses name button" %}</button>
            </li>
            <li>
              <button hx-get="{% url 'savings:type_new' %}" hx-target="#mainModal">{% translate 'Fund' context 'fund button' %}</button>
            </li>
          </ul>
        </li>

        <!-- Day of year -->
        <li>{{ yday }} / <b>{{ ydays }}</b></li>

        <!-- User settings -->
        <li class="dropdown">
          <a class="dropdown__title" href="#" role="button">{{ user.username }}</a>
          <ul class="dropdown__menu left">
            <li><a href="{% url 'users:logout' %}">{% translate 'Log out' %}</a></li>
            <li><a href="{% url 'users:password_change' %}">{% translate 'Change password' %}</a></li>
            {% if user.is_superuser %}
            <li class="dropdown-divider"></li>
            <li><a role="button" href="{% url 'users:settings_index' %}">{% translate 'Settings' %}</a></li>
            {% endif %}
          </ul>
        </li>
      </ul>
    </nav>

      <!-- Loader -->
      <div class="htmx-indicator loader loader-default is-active" id="indicator"></div>
      {% block content %}{% endblock content %}

    {% endblock body %}

    <div id="containerModal" class="modal">
      <div id="mainModal" class="modal-dialog modal-500" hx-target="this" hx-ext="alpine-morph" hx-swap="morph" x-data="{ inserted: false }"></div>
    </div>

    <script src="{% static 'js/modal.js' %}"></script>

  </body>
</html>
