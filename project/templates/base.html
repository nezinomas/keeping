{% load static %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx.org@1.9.11" integrity="sha384-0gxUXCCR8yv9FM2b+U3FDbsKthCI66oH5IA9fHppQq9DDMHuMauqq1ZHBpJxQ0J0" crossorigin="anonymous"></script> <!-- Htmx -->
    <script defer src="https://unpkg.com/@alpinejs/morph@3.10.2/dist/cdn.min.js"></script><!-- Alpine Plugins -->
    <script defer src="https://unpkg.com/alpinejs@3.10.2/dist/cdn.min.js"></script> <!-- Alpine Core -->
    {% include 'core/includes/form_date_scripts.html' %}

    <link rel="stylesheet" href="{% static 'bootstrap_datepicker/css/bootstrap-datetimepicker.min.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap_datepicker_plus/css/datepicker-widget.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/css-loader.css' %}">

    {% block head %}{% endblock head %}

    <title>{{ user.journal.title }}</title>
    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}">
  </head>

  <body tabindex="-1">
    {% block body %}

    <nav id="main-nav">
      <!-- Years Dropdown -->
      <div {% if '/' == request.path %}class="active"{% endif %}>
        <a href="{% url 'bookkeeping:index' %}">{{ request.user.year|title }}</a>
        <div class="dropdown">
          <button class="dropdown__btn"></button>
          <div class="dropdown__menu">
            {% for y in years %}
            <a href="{% url 'core:set_year' y %}">{{ y|safe }}</a>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Month -->
      <a href="{% url 'bookkeeping:month' %}" {% if '/month/' == request.path %}class="active"{% endif %}>{% translate 'Month' %}</a>

      <!-- Detailed -->
      <a href="{% url 'bookkeeping:detailed' %}" {% if '/detailed/' == request.path %}class="active"{% endif %}>{% translate 'Detailed' %}</a>

      <!-- Expenses -->
      <div {% if '/expenses/' in request.path and not '/summary/' in request.path %}class="active"{% endif %}>
        <a href="{% url 'expenses:index' %}">{% translate 'Expenses' %}</a>
        <div class="dropdown">
          <button class="dropdown__btn"></button>
          <div class="dropdown__menu">
            {% for m in context_months %}
            {% with m|date:'n' as m_num %}
            <a href="{% url 'expenses:index' forloop.counter %}">{{ m|date:'F'|title }}</a>
            {% endwith %}{% endfor %}
            <span class="dropdown-divider"></span>
            <a href="{% url 'expenses:index' 13 %}">{% translate 'All records' %}</a>
          </div>
        </div>
      </div>

      <!-- Incomes -->
      <a href="{% url 'incomes:index' %}" {% if '/incomes/' in request.path %}class="active"{% endif %}>{% translate 'Incomes' %}</a>

      <!-- Transactions -->
      <a  href="{% url 'transactions:index' %}" {% if '/transactions/' in request.path %}class="active"{% endif %}>{% translate 'Transactions' %}</a>

      <!-- Savings -->
      <a href="{% url 'savings:index' %}" {% if '/savings/' in request.path and not '/summary/' in request.path %}class="active"{% endif %}>{% translate 'Savings' %}</a>

      <!-- Debts -->
      <a href="{% url 'debts:index' %}" {% if '/debts/' in request.path %}class="active"{% endif %}>{% translate 'Debts' %}</a>

      <!-- Books -->
      <div {% if '/books/' in request.path %}class="active"{% endif %}>
        <a href="{% url 'books:index' %}">{% translate 'Books' %}</a>
        <div class="dropdown">
            <button class="dropdown__btn"></button>
            <div class="dropdown__menu">
              <a href="{% url 'books:index' %}?tab=all">{% translate 'All records' %}</a>
            </div>
        </div>
      </div>

      <!-- Drinks -->
      <a href="{% url 'drinks:index' %}" {% if '/drinks/' in request.path %}class="active"{% endif %}>{% translate 'Drinks' %}</a>

      <!-- Counters -->
      <div {% if '/counts/' in request.path %}class="active"{% endif %}>
        <a href="{% url 'counts:redirect' %}">{% translate 'Counter' %}</a>
        <div class="dropdown">
            <button class="dropdown__btn"></button>
            <div class="dropdown__menu">
              {% if counts_menu %}{{ counts_menu }}{% endif %}
              <span class="dropdown-divider"></span>
              <a role="button" href="#" hx-get="{% url 'counts:type_new' %}" hx-target="#mainModal">{% translate 'Add count type' %}</a>
            </div>
        </div>
      </div>

      <!-- Plans -->
      <a href="{% url 'plans:index' %}" {% if '/plans/' in request.path %}class="active"{% endif %}>{% translate 'Plans' %}</a>

      <!-- Charts -->
      <div {% if 'summary' in request.path %}class="active"{% endif %}>
        <a href="{% url 'bookkeeping:summary' %}">{% translate 'Charts' %}</a>
        <div class="dropdown">
            <button class="dropdown__btn"></button>
            <div class="dropdown__menu">
              <a href="{% url 'bookkeeping:summary' %}">{% translate 'Incomes' %} & {% translate 'Expenses' %}</a>
              <a href="{% url 'bookkeeping:summary_savings_and_incomes' %}">{% translate 'Incomes'%} & {% translate 'Savings' %}</a>
              <a href="{% url 'bookkeeping:summary_savings' %}">{% translate 'Savings' %}</a>
              <a href="{% url 'bookkeeping:summary_expenses' %}">{% translate 'Expenses' %}</a>
            </div>
        </div>
      </div>

      <!-- Add butons -->
      <div>
        <a href="#" role="button">{% translate 'Add' %}</a>
        <div class="dropdown">
            <button class="dropdown__btn"></button>
            <div class="dropdown__menu">
              <a role="button" class="no-hover" hx-get="{% url 'incomes:new' %}" hx-target="#mainModal">{% translate 'Incomes' context 'incomes button' %}</a>
              <a role="button" class="no-hover" hx-get="{% url 'expenses:new' %}" hx-target="#mainModal">{% translate "Expenses" context "expenses button" %}</a>
              <a role="button" class="no-hover" hx-get="{% url 'transactions:new' %}" hx-target="#mainModal">{% translate 'Transactions' context "transactions button" %}</a>
              <a role="button" class="no-hover" hx-get="{% url 'savings:new' %}" hx-target="#mainModal">{% translate 'Savings' context "savings button" %}</a>
              <span class="dropdown-divider"></span>
              <a role="button" class="no-hover" hx-get="{% url 'accounts:new' %}" hx-target="#mainModal">{% translate 'Account' context 'account button' %}</a>
              <a role="button" class="no-hover" hx-get="{% url 'incomes:type_new' %}" hx-target="#mainModal">{% translate 'Incomes type' context 'income type button' %}</a>
              <a role="button" class="no-hover" hx-get="{% url 'expenses:type_new' %}" hx-target="#mainModal">{% translate "Expenses type" context "expenses type button" %}</a>
              <a role="button" class="no-hover" hx-get="{% url 'expenses:name_new' %}" hx-target="#mainModal">{% translate "Expenses name" context "expenses name button" %}</a>
              <a role="button" class="no-hover" hx-get="{% url 'savings:type_new' %}" hx-target="#mainModal">{% translate 'Fund' context 'fund button' %}</a>
            </div>
        </div>
      </div>

      <!-- Day of year -->
      <div class="day-of-year">{{ yday }} / <b>{{ ydays }}</b></div>

      <!-- User settings -->
      <div {% if 'settings' in request.path %}class="active"{% endif %}>
        <a href="#" role="button">{{ user.username }}</a>
        <div class="dropdown left">
            <button class="dropdown__btn"></button>
            <div class="dropdown__menu">
              <a href="{% url 'users:logout' %}">{% translate 'Log out' %}</a>
              <a href="{% url 'users:password_change' %}">{% translate 'Change password' %}</a>
              {% if user.is_superuser %}
              <span class="dropdown-divider"></span>
              <a role="button" href="{% url 'users:settings_index' %}">{% translate 'Settings' %}</a>
              {% endif %}
            </div>
        </div>
      </div>
    </nav>

    <!-- Loader -->
    <div class="htmx-indicator loader loader-default is-active" id="indicator"></div>
    {% block content %}{% endblock content %}

    {% endblock body %}

    <div id="mainModalContainer" class="modal">
      <div id="mainModal" class="modal-dialog" hx-target="this" hx-ext="alpine-morph" hx-swap="morph" x-data="{ inserted: false }"></div>
    </div>

    <script src="{% static 'js/modal.js' %}"></script>

  </body>
</html>
