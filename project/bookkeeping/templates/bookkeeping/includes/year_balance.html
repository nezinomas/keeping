{% load i18n %}
{% load slippers %}
{% load math %}

<table class="table table-sm table-striped table-hover" x-data="{ open:false }">
    <thead>
        <tr>
            <th colspan="4" class="text-start">{% translate 'Balance' %}</th>
            <th colspan="2" class="left-blue-border right-blue-border text-start">{% translate 'Savings' %}</th>
            <th colspan="4" class="left-blue-border right-blue-border text-start" x-show="open">{% translate 'Debts' %}</th>
            <th class="text-nowrap">
                <button class="btn btn-xs no-hover" style="font-weight: bold; color: #0d6efd; padding-right: 0!important;" @click="open = ! open" x-text="open ? '{% translate "Hide debts" %}' : '{% translate "Show debts" %}' "></button>
            </th>
        </tr>
        <tr>
            <th class="text-start w5">{{ year|title }}</th>
            <th>{% translate 'Incomes' %}</th>
            <th>{% translate 'Expenses' %}</th>
            <th>{% translate 'Balance' %}</th>
            <th class="left-blue-border">{% translate 'Invested' %}</th>
            <th class="right-blue-border">{% translate 'Sold' %}</th>
            <th class="left-blue-border" x-show="open">{% translate 'Borrow' %}</th>
            <th x-show="open">{% translate 'Borrow return' %}</th>
            <th x-show="open">{% translate 'Lend' %}</th>
            <th class="right-blue-border" x-show="open">{% translate 'Lend return' %}</th>
            <th class="text-nowrap">{% translate 'Money flow' %}</th>
        </tr>
    </thead>
    <tbody>
        {% for item in ctx.data %}
        <tr>
            {% table_cell value=item.date|date:"F"|title css_class="text-start" %}
            {% table_cell value=item.incomes|price %}
            {% table_cell value=item.expenses|price %}
            {% table_cell value=item.balance|price highlight_value=True  %}
            {% table_cell value=item.savings|price css_class="left-blue-border" %}
            {% table_cell value=item.savings_close|price css_class="right-blue-border"  %}
            {% table_cell value=item.borrow|price css_class="left-blue-border" alpinejs='x-show="open"' %}
            {% table_cell value=item.borrow_return|price alpinejs='x-show="open"' %}
            {% table_cell value=item.lend|price alpinejs='x-show="open"' %}
            {% table_cell value=item.lend_return|price css_class="right-blue-border" alpinejs='x-show="open"' %}
            {% table_cell value=item.money_flow|price %}
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr>
            <th class="text-start">Avg</th>
            {% table_cell value=ctx.avg_row.incomes|price tag='th' %}
            {% table_cell value=ctx.avg_row.expenses|price tag='th' %}
            {% table_cell value='' tag='th' %}
            {% table_cell value=ctx.avg_row.savings|price tag='th' css_class="left-blue-border" %}
            {% table_cell value=ctx.avg_row.savings_close|price tag='th' css_class="right-blue-border" %}
            {% table_cell value=ctx.avg_row.borrow|price tag='th' css_class="left-blue-border" alpinejs='x-show="open"' %}
            {% table_cell value=ctx.avg_row.borrow_return|price tag="th" alpinejs='x-show="open"' %}
            {% table_cell value=ctx.avg_row.lend|price tag="th" alpinejs='x-show="open"' %}
            {% table_cell value=ctx.avg_row.lend_return|price tag="th" css_class="right-blue-border" alpinejs='x-show="open"' %}
            <th><b>{% translate "End of year" %}</b></th>
        </tr>
        <tr>
            <th class="text-start">{% translate 'Total' %}</th>
            {% table_cell value=ctx.total_row.incomes|price tag='th' %}
            {% table_cell value=ctx.total_row.expenses|price tag='th' %}
            {% table_cell value=ctx.total_row.balance|price tag='th' highlight_value=True %}
            {% table_cell value=ctx.total_row.savings|price tag='th' css_class="left-blue-border" %}
            {% table_cell value=ctx.total_row.savings_close|price tag='th' css_class="right-blue-border" %}
            {% table_cell value=ctx.total_row.borrow|price tag='th' css_class="left-blue-border" alpinejs='x-show="open"' %}
            {% table_cell value=ctx.total_row.borrow_return|price tag="th" alpinejs='x-show="open"' %}
            {% table_cell value=ctx.total_row.lend|price tag="th" alpinejs='x-show="open"' %}
            {% table_cell value=ctx.total_row.lend_return|price tag="th" css_class="right-blue-border" alpinejs='x-show="open"' %}
            {% table_cell value=ctx.amount_end|price tag='th' css_class="check" highlight_value=True %}
        </tr>
    </tfoot>
</table>
