{% extends 'base.html' %}

{% block head %}
<script src="https://code.highcharts.com/highcharts.src.js"></script>
{% endblock head %}


{% block content %}

<div class="row my-2 border-bottom border-primary">
    <div class="col-lg-4">{{ year_balance }}</div>
    <div class="col-lg-8">{{ year_expenses }}</div>
</div>

<div class="row my-2 border-bottom border-primary">
    <div class="col-lg-5">{{ chart_expenses }}</div>
    <div class="col-lg-7">{{ chart_balance }}</div>
</div>

<div class="row mt-4 mb-3">
    <div class="col-lg-12">
        {% url 'bookkeeping:accounts_worth_new' as url_accounts %}
        <button type="button" class="btn btn-sm btn-outline-success js-create" data-url="{{ url_accounts }}"><i class="bi bi-plus"></i> Sąskaitų faktas</button>
        {% url 'bookkeeping:savings_worth_new' as url_expenses_new %}
        <button type="button" class="btn btn-sm btn-outline-success js-create" data-url="{{ url_expenses_new }}"><i class="bi bi-plus"></i> Fondų faktas</button>
        {% url 'bookkeeping:pensions_worth_new' as url_pensions_new %}
        <button type="button" class="btn btn-sm btn-outline-success js-create" data-url="{{ url_pensions_new }}"><i class="bi bi-plus"></i> Pensijos faktas</button>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'core:regenerate_balances_current_year' year %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Bus atnaujintas šių metų balansas."><i class="bi bi-arrow-repeat"></i> Atnaujinti {{ year|safe }} balansus</a>
        <a class="btn btn-sm btn-outline-danger" href="{% url 'core:regenerate_balances' %}" data-bs-toggle="tooltip" data-bs-placement="top" title="Bus atnaujinti visų metų balansai."><i class="bi bi-arrow-repeat"></i> Atnaujinti balansus</a>
    </div>
</div>

<!-- accounts stats -->
<div class="row mt-2">
    <div id="accounts_worth" class="col-lg-7">{{ accounts }}</div>
    <div class="col-lg-3">
        <div class="row">
            <div class="col-lg-12 col-md-6">
                <div>{{ year_balance_short }}</div>
            </div>
            <div class="col-lg-12 col-md-6">
                <div id="no_incomes">{{ no_incomes }}</div>
            </div>
        </div>
    </div>

    <div class="col-lg-2">
        <div class="row">
            <div class="col-lg-12 col-md-3">
                <!-- Average Incomes -->
                <div id="avg_incomes">{{ avg_incomes }}</div>
            </div>

            <div class="col-lg-12 col-md-3">
                <!-- Average Expenses -->
                <div id="avg_expenses">{{ avg_expenses }}</div>
            </div>

            <div class="col-lg-12 col-md-3">
                <!-- Money -->
                <div id="money">{{ money }}</div>
            </div>

            <div class="col-lg-12 col-md-3">
                <!-- Worth -->
                <div id="wealth">{{ wealth }}</div>
            </div>
        </div>
    </div>
</div>


<!-- savings -->
<div class="row mt-5">
    <div id="saving_worth" class="col-lg-12">{{ savings }}</div>
</div>

<!-- pensions -->
<div class="row mt-5">
    <div id="pension_worth" class="col-lg-12">{{ pensions }}</div>
</div>

{% include 'modal.html' %}

<script>
    $(function () {
        var load_html = function () {
            var btn = $(this);
            var url = btn.data('url');

            if (url == undefined || !url) {
                return;
            }

            $.ajax({
                url: url,
                data: {
                    'ajax_trigger': '1'
                },
                success: function (data) {
                    if (data) {
                        var accounts = $(data).filter('#accounts_worth');
                        $('#accounts_worth').html(accounts);
                    }
                }
            });
        };

        $(document).on('click', '.reset', load_html);
    });

    $(document).on('hidden.bs.modal', '#modal-form', function () {
        var url = `{% url 'bookkeeping:reload_index' %}`;

        $.ajax({
            url: url,
            data: {
                'ajax_trigger': '1'
            },
            success: function (data) {
                var no_incomes = $(data).filter('#no_incomes');
                $('#no_incomes').html(no_incomes);

                var money = $(data).filter('#money');
                $('#money').html(money);

                var wealth = $(data).filter('#wealth');
                $('#wealth').html(wealth);

                var savings = $(data).filter('#saving_worth');
                $('#saving_worth').html(savings);
            }
        });
    });
</script>
{% endblock content %}

