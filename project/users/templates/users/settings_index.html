{% extends 'base.html' %}
{% load i18n %}

{% block head %}
<style>
    .settings_row {
        background-color: aliceblue;
        margin: 0.5rem 0;
        padding: 0!important;
    }
    .settings_row .btn-sm {
        margin: 0.2rem 0;
    }
</style>
{% endblock head %}

{% block content %}

<div class="row mt-2 mx-0">
    <div class="col text-center bg-light"><h6 class="pt-1 pb-2">{% translate 'Settings' %}</h6></div>
</div>

<div class="row">
    <div class="col">
        <div class="row settings_row">
            <div class="col">
                <h6 class="pb-2">{% translate 'Journal settings' %}</h6>
            </div>
        </div>
        <div id="journal_ajax" class="mt-3">{{ settings_journal }}</div>
    </div>

    <div class="col">
        <div class="row settings_row">
            <div class="col"><h6 class="pb-2">{% translate 'Users'%}</h6></div>
            <div class="col text-end pe-0 me-2"><a role="button" class="btn btn-sm btn-primary js-invite" data-url="{% url 'users:invite' %}">{% translate 'Sent invite link' %}</a></div>
        </div>
        <div id="user_list" class="mt-3">{{ users }}</div>
    </div>

    <div class="col">
        <div class="row settings_row">
            <div class="col"><h6 class="pb-2">{% translate 'Unneccessary expenses' %}</h6></div>
        </div>
        <div id="unnecessary_ajax" class="mt-3">{{ settings_unnecessary }}</div>
    </div>
</div>

<script>
    $(function () {
        var unnecesaryForm = function (event) {
            var form_name = $(this).data('form')
            var form = $('.js_' + form_name);
            var ajax_update_container = form.attr('data-update-container')

            $.ajax({
                url: form.attr("action"),
                data: new FormData($('.js_' + form_name)[0]), // The form with the file inputs.
                processData: false,
                contentType: false,
                type: form.attr("method"),
                dataType: 'json',
                success: function (data) {
                    $(`#${ajax_update_container}`).html(data.html_form);

                    if (data.redirect) {
                        window.location.replace(data.redirect);
                    }
                }
            });
s        };

        /* Binding */
        $(document).on('click', '#settings_submit', unnecesaryForm);
    });
</script>
{% endblock content %}
