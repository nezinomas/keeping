{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block head %}
<script src="{% static 'js/reload_stats.js' %}"></script>
{% endblock head %}


{% block content %}
<div class="row gx-2">
    <!-- Borrow -->
    <div class="col-sm-12 col-lg-6">
        <div class="row py-2">
            <div class="col"><h6>{% translate 'Borrow' %}</h6></div>
            <div class="col text-end">
                <button type="button" class="btn btn-sm btn-outline-success js-create set-target" data-url="{% url 'debts:borrows_new' %}" data-target="borrow"><i class="bi bi-plus"></i>{% translate "Debt" context "debt button" %}</button>
            </div>
        </div>

        <div class="row">
            <div class="col" id="borrow">{{ borrow }}</div>
        </div>
    </div>

    <!-- Debt -->
    <div class="col-sm-12 col-lg-6">
        <div class="row py-2">
            <div class="col">
                <h6>{% translate 'Debt' %}</h6>
            </div>
            <div class="col text-end">
                <button type="button" class="btn btn-sm btn-outline-success js-create set-target" data-url="{% url 'debts:debts_new' %}" data-target="debt"><i class="bi bi-plus"></i>{% translate "Debt" context "debt button" %}</button>
            </div>
        </div>

        <div class="row">
            <div class="col" id="debt">{{ debt }}</div>
        </div>
    </div>
</div>

<div class="row gx-2">
    <!-- Borrow Return -->
    <div class="col-sm-12 col-lg-6">
        <div class="row py-2">
            <div class="col">
                <h6>{% translate 'Returned borrow' %}</h6>
            </div>
            <div class="col text-end">
                <button type="button" class="btn btn-sm btn-outline-success js-create set-target" data-url="{% url 'debts:borrows_return_new' %}" data-target="borrow"><i class="bi bi-plus"></i>{% translate "Sum" context "sum button" %}</button>
            </div>
        </div>

        <div class="row">
            <div class="col" id="borrow_return">{{ borrow_return }}</div>
        </div>
    </div>

    <!-- Debt Return -->
    <div class="col-sm-12 col-lg-6">
        <div class="row py-2">
            <div class="col">
                <h6>{% translate 'Returned debt' %}</h6>
            </div>
            <div class="col text-end">
                <button type="button" class="btn btn-sm btn-outline-success js-create set-target" data-url="{% url 'debts:debts_return_new' %}" data-target="debt"><i class="bi bi-plus"></i>{% translate "Sum" context "sum button" %}</button>
            </div>
        </div>

        <div class="row">
            <div class="col" id="debt_return">{{ debt_return }}</div>
        </div>
    </div>
</div>

<script>
    var setTarget = function() {
        var target =  $(this).attr("data-target");
        $("#modal-form").attr("data-target", target)
    }
    $(document).on('click', '.set-target', setTarget);

    $(document).on('hidden.bs.modal', '#modal-form', function () {
        var target = $("#modal-form").attr("data-target");
        var url = `{% url 'debts:debts_index' %}`;
        var blocks = [];


        if (target == 'borrow') {
            url = `{% url 'debts:borrows_reload' %}`;
            blocks.push("borrow", "borrow_return");
        }

        if (target == 'debt') {
            url = `{% url 'debts:debts_reload' %}`;
            blocks.push("debt", "debt_return");
        }

        $.ajax({
            url: url,
            data: {
                'ajax_trigger': '1',
            },
            success: function (data) {
                reload_stats(data, blocks);
            }
        });
    });
</script>

{% endblock content %}
