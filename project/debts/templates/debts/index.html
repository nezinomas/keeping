{% extends 'base.html' %}{% load static %}

{% block head %}
<script src="{% static 'js/reload_stats.js' %}"></script>
{% endblock head %}


{% block content %}
<div class="row gx-2">
    <!-- Borrow -->
    <div class="col-sm-12 col-lg-6">
        <div class="row py-2">
            <div class="col"><h6>Paskolinau</h6></div>
            <div class="col text-end">
                <button type="button" class="btn btn-sm btn-outline-success js-create set-target" data-url="{% url 'debts:borrows_new' %}" data-target="borrow"><i class="bi bi-plus"></i>Skolą</button>
            </div>
        </div>

        <div class="row">
            <div class="col" id="borrow_ajax">{{ borrow }}</div>
        </div>
    </div>

    <!-- Lent -->
    <div class="col-sm-12 col-lg-6">
        <div class="row py-2">
            <div class="col">
                <h6>Pasiskolinau</h6>
            </div>
            <div class="col text-end">
                <button type="button" class="btn btn-sm btn-outline-success js-create set-target" data-url="{% url 'debts:lents_new' %}" data-target="lent"><i class="bi bi-plus"></i>Skolą</button>
            </div>
        </div>

        <div class="row">
            <div class="col" id="lent_ajax">{{ lent }}</div>
        </div>
    </div>
</div>

<div class="row gx-2">
    <!-- Borrow Return -->
    <div class="col-sm-12 col-lg-6">
        <div class="row py-2">
            <div class="col">
                <h6>Gražino</h6>
            </div>
            <div class="col text-end">
                <button type="button" class="btn btn-sm btn-outline-success js-create set-target" data-url="{% url 'debts:borrows_return_new' %}" data-target="borrow"><i class="bi bi-plus"></i>Sumą</button>
            </div>
        </div>

        <div class="row">
            <div class="col" id="borrow_return_ajax">{{ borrow_return }}</div>
        </div>
    </div>

    <!-- Lent Return -->
    <div class="col-sm-12 col-lg-6">
        <div class="row py-2">
            <div class="col">
                <h6>Gražinau</h6>
            </div>
            <div class="col text-end">
                <button type="button" class="btn btn-sm btn-outline-success js-create set-target" data-url="{% url 'debts:lents_return_new' %}" data-target="lent"><i class="bi bi-plus"></i>Sumą</button>
            </div>
        </div>

        <div class="row">
            <div class="col" id="lent_return_ajax">{{ lent_return }}</div>
        </div>
    </div>
</div>

<script>
    var setTarget = function() {
        var target =  $(this).attr("data-target");
        $("#modal-form").attr("data-target", target)
    }
    $(document).on('click', '.set-target', setTarget);

    $(document).on('hidden.bs.modal', '#modal-form', function () {
        var target = $("#modal-form").attr("data-target");
        var url = `{% url 'debts:debts_index' %}`;
        var blocks = [];


        if (target == 'borrow') {
            url = `{% url 'debts:borrows_reload' %}`;
            blocks.push("borrow_ajax", "borrow_return_ajax");
        }

        if (target == 'lent') {
            url = `{% url 'debts:lents_reload' %}`;
            blocks.push("lent_ajax", "lent_return_ajax");
        }

        $.ajax({
            url: url,
            data: {
                'ajax_trigger': '1',
            },
            success: function (data) {
                reload_stats(data, blocks);
            }
        });
    });
</script>

{% endblock content %}
